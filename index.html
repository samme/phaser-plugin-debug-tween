<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=960, initial-scale=1">
<style>
html,body{height: 100%;}
body{margin: 0; padding: 0; background: #111; color: #eee;}
</style>
<title>Phaser Debug Tween plugin example</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.0/dat.gui.js"></script>
<script src="index.js"></script>
<script>

var Back      = Phaser.Easing.Back;
var Bounce    = Phaser.Easing.Bounce;
var Cubic     = Phaser.Easing.Cubic;
var Quadratic = Phaser.Easing.Quadratic;

var onDown = function (sprite){
    sprite.tint = 0xffff00;
};

var onUp = function (sprite){
    sprite.tint = 0xffffff;
    switch (sprite.text) {
        case "Start"  : this.tween.start()  ; break ;
        case "Stop"   : this.tween.stop()   ; break ;
        case "Pause"  : this.tween.pause()  ; break ;
        case "Resume" : this.tween.resume() ; break ;
    }
};

var tweenGui = function (tween){
    var gui = new dat.GUI;
    gui.add(tween, "frameBased");
    gui.add(tween, "loop");
    gui.add(tween, "pause");
    gui.add(tween, "repeatAll");
    gui.add(tween, "repeatCounter").listen();
    gui.add(tween, "resume");
    gui.add(tween, "reverse");
    gui.add(tween, "start");
    gui.add(tween, "stop");
    gui.add(tween, "timeScale", 0.25, 2, 0.25);
    return gui;
};

new Phaser.Game({
    antialias: false,
    width: 960,
    height: 600,
    renderer: Phaser.CANVAS,
    scaleMode: Phaser.ScaleManager.SHOW_ALL,
    state: {
        init: function (){

            console.assert(Phaser.Plugin.DebugTween, "Phaser.Plugin.DebugTween");

            this.game.plugins.add(Phaser.Plugin.DebugTween);

            console.assert(this.game.debug.tween, "game.debug.tween");
            console.assert(this.game.debug.tweenData, "game.debug.tweenData");

        },
        preload: function (){

            this.load.baseURL = 'http://examples.phaser.io/assets/';
            this.load.crossOrigin = 'anonymous';

            this.load.image('bunny', 'sprites/bunny.png');

        },
        create: function (){

            var centerX = this.world.centerX;
            var centerY = this.world.centerY;
            var TURN = 2 * Math.PI;

            this.sprite = this.add.sprite(centerX, -centerY, 'bunny');
            this.sprite.anchor.set(0.5);

            this.tween = this.add.tween(this.sprite)
            .to( { y: centerY }, 1500, Bounce.Out)
            .to( { rotation: 1 * TURN,  x:  2 * centerX }, 1000, Back.InOut)
            .to( { rotation: 0,         x:      centerX }, 1000, Back.InOut, false, 500)
            .to( { alpha: 0, y: 2 * centerY }, 500, Quadratic.In);

            this.tween.timeScale = 0.5;

            this.time.events.add(250, function (){
                this.gui = tweenGui(this.tween);
            }, this);

            var buttons = this.add.group();
            buttons.inputEnableChildren = true;
            buttons.onChildInputDown.add(onDown, this);
            buttons.onChildInputUp.add(onUp, this);
            buttons.setAll("input.useHandCursor", true);

            var style = {fill: "white", font: "32px cursive"}

            this.add.text(0, 0, "Start",  style, buttons);
            this.add.text(0, 0, "Stop",   style, buttons);
            this.add.text(0, 0, "Pause",  style, buttons);
            this.add.text(0, 0, "Resume", style, buttons);

            buttons.x = 32;
            buttons.align(-1, 1, 128, 64);
            buttons.alignIn(this.game.camera.view, Phaser.BOTTOM_CENTER);
            console.log(this.game.camera.view, buttons.getBounds(), buttons.children[0].getBounds());

        },
        render: function (){

            var debug = this.game.debug;
            var current = this.tween.timeline[this.tween.current]

            debug.tween(this.tween, 20, 20);
            debug.tweenInfo(this.tween, 480, 20);
            debug.tweenDataInfo(current, 720, 20);
            debug.tweenDataValues(current, 720, 280);

        },
        shutdown: function (){

            this.gui.destroy();

        }
    }
});

</script>

